-- testdata/hooks.lua
-- Tests pre_exec and post_exec hooks

-- Used to track execution order.
EXECUTION_ORDER = {}

workflow({
    name = "test_hooks",
    description = "Tests pre_exec and post_exec hooks",
    tasks = {
        {
            name = "task_with_hooks",
            pre_exec = function()
                table.insert(EXECUTION_ORDER, "PRE_EXEC")
                return {changed = false, message = "Pre-hook OK"}
            end,
            run = function()
                table.insert(EXECUTION_ORDER, "COMMAND")
                return {changed = false, message = "Command OK", output_data = "some_result"}
            end,
            post_exec = function(params, output)
                table.insert(EXECUTION_ORDER, "POST_EXEC")
                if output.output_data == "some_result" then
                    return {changed = false, message = "Post-hook OK"}
                else
                    return {failed = true, message = "Post-hook failed to receive output"}
                end
            end
        }
    }
})