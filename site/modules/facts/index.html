<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The world's first AI-powered task orchestration platform with native GitOps capabilities. Features intelligent optimization, predictive analytics, automated deployments, and enterprise-grade reliability."><meta name=author content="Sloth Runner Team"><link href=https://chalkan3-sloth.github.io/sloth-runner/modules/facts/ rel=canonical><link rel=icon href=../../assets/favicon.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.20"><title>Facts Module - 🦥 Sloth Runner - AI-Powered GitOps Task Orchestration Platform</title><link rel=stylesheet href=../../assets/stylesheets/main.e53b48f4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#facts-module class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://chalkan3-sloth.github.io/sloth-runner/ title="🦥 Sloth Runner - AI-Powered GitOps Task Orchestration Platform" class="md-header__button md-logo" aria-label="🦥 Sloth Runner - AI-Powered GitOps Task Orchestration Platform" data-md-component=logo> <img src=../../assets/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 🦥 Sloth Runner - AI-Powered GitOps Task Orchestration Platform </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Facts Module </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/chalkan3-sloth/sloth-runner title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> chalkan3-sloth/sloth-runner </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 🏠 Home </a> </li> <li class=md-tabs__item> <a href=../../en/quick-start class=md-tabs__link> 🚀 Quick Start </a> </li> <li class=md-tabs__item> <a href=../../en/getting-started class=md-tabs__link> 📚 Core Documentation </a> </li> <li class=md-tabs__item> <a href=../../architecture/sloth-runner-architecture class=md-tabs__link> 🏗️ Architecture </a> </li> <li class=md-tabs__item> <a href=../../modern-dsl/introduction class=md-tabs__link> 🎨 Modern DSL </a> </li> <li class=md-tabs__item> <a href=../ class=md-tabs__link> 🔧 Modules </a> </li> <li class=md-tabs__item> <a href=../../state-management class=md-tabs__link> 🗄️ State Management </a> </li> <li class=md-tabs__item> <a href=../../guides/values-delegate-to class=md-tabs__link> 📖 Guides </a> </li> <li class=md-tabs__item> <a href=../../en/advanced-examples class=md-tabs__link> 🎭 Examples </a> </li> <li class=md-tabs__item> <a href=../../en/ai-features class=md-tabs__link> ⚡ Enterprise Features </a> </li> <li class=md-tabs__item> <a href=../../en/testing class=md-tabs__link> 🧪 Testing & Development </a> </li> <li class=md-tabs__item> <a href=../../en/getting-started class=md-tabs__link> 🇺🇸 English </a> </li> <li class=md-tabs__item> <a href=../../pt/getting-started class=md-tabs__link> 🇧🇷 Português </a> </li> <li class=md-tabs__item> <a href=../../zh/getting-started class=md-tabs__link> 🇨🇳 中文 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://chalkan3-sloth.github.io/sloth-runner/ title="🦥 Sloth Runner - AI-Powered GitOps Task Orchestration Platform" class="md-nav__button md-logo" aria-label="🦥 Sloth Runner - AI-Powered GitOps Task Orchestration Platform" data-md-component=logo> <img src=../../assets/logo.svg alt=logo> </a> 🦥 Sloth Runner - AI-Powered GitOps Task Orchestration Platform </label> <div class=md-nav__source> <a href=https://github.com/chalkan3-sloth/sloth-runner title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> chalkan3-sloth/sloth-runner </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> 🏠 Home </span> </a> </li> <li class=md-nav__item> <a href=../../en/quick-start class=md-nav__link> <span class=md-ellipsis> 🚀 Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> 📚 Core Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 📚 Core Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../en/getting-started class=md-nav__link> <span class=md-ellipsis> 🛠️ Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../en/master-agent-architecture class=md-nav__link> <span class=md-ellipsis> 🚀 Agent Bootstrap </span> </a> </li> <li class=md-nav__item> <a href=../../en/gitops-features class=md-nav__link> <span class=md-ellipsis> 🎯 GitOps Example </span> </a> </li> <li class=md-nav__item> <a href=../../en/core-concepts class=md-nav__link> <span class=md-ellipsis> 🧠 Core Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../idempotency class=md-nav__link> <span class=md-ellipsis> 🔄 Idempotency 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../stack-idempotency-guide class=md-nav__link> <span class=md-ellipsis> 📊 Stack Management & State 🚀 </span> </a> </li> <li class=md-nav__item> <a href=../../en/enterprise-features class=md-nav__link> <span class=md-ellipsis> 🆕 Latest Features </span> </a> </li> <li class=md-nav__item> <a href=../../en/stack-management class=md-nav__link> <span class=md-ellipsis> 🗂️ Stack Management </span> </a> </li> <li class=md-nav__item> <a href=../../en/advanced-features class=md-nav__link> <span class=md-ellipsis> 🎯 Advanced Features </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 🏗️ Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 🏗️ Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../architecture/sloth-runner-architecture class=md-nav__link> <span class=md-ellipsis> 📐 System Architecture 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/hooks-events-system class=md-nav__link> <span class=md-ellipsis> ⚡ Hooks & Events System 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/modular-design class=md-nav__link> <span class=md-ellipsis> 🔧 Modular Design </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/refactoring-guide class=md-nav__link> <span class=md-ellipsis> ♻️ Refactoring Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> 🎨 Modern DSL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 🎨 Modern DSL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../modern-dsl/introduction class=md-nav__link> <span class=md-ellipsis> 📖 DSL Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../modern-dsl/module-api-examples class=md-nav__link> <span class=md-ellipsis> 🎯 Module API Examples 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../modern-dsl/best-practices class=md-nav__link> <span class=md-ellipsis> 📚 Best Practices </span> </a> </li> <li class=md-nav__item> <a href=../../modern-dsl/reference-guide class=md-nav__link> <span class=md-ellipsis> 📖 Reference Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 🔧 Modules </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 🔧 Modules </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> 🔧 Module Index </span> </a> </li> <li class=md-nav__item> <a href=../../modules-list-command class=md-nav__link> <span class=md-ellipsis> 📋 CLI: modules list 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../features/global-modules class=md-nav__link> <span class=md-ellipsis> 🌍 Global Modules (No require!) 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../goroutine class=md-nav__link> <span class=md-ellipsis> ⚡ Goroutine (Parallel) 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../infra_test class=md-nav__link> <span class=md-ellipsis> 🧪 Infrastructure Testing 🔥 </span> </a> </li> <li class=md-nav__item> <a href=. class=md-nav__link> <span class=md-ellipsis> 📊 Facts (Agent Info) 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../incus class=md-nav__link> <span class=md-ellipsis> 📦 Incus (LXC/VM Deploy) 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../pkg class=md-nav__link> <span class=md-ellipsis> 📦 Package Management </span> </a> </li> <li class=md-nav__item> <a href=../user class=md-nav__link> <span class=md-ellipsis> 👤 User Management </span> </a> </li> <li class=md-nav__item> <a href=../file_ops class=md-nav__link> <span class=md-ellipsis> 📁 File Operations </span> </a> </li> <li class=md-nav__item> <a href=../stow class=md-nav__link> <span class=md-ellipsis> 🔗 Stow (Dotfiles) 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../ssh class=md-nav__link> <span class=md-ellipsis> 🔐 SSH Module </span> </a> </li> <li class=md-nav__item> <a href=../git class=md-nav__link> <span class=md-ellipsis> 🔀 Git Module </span> </a> </li> <li class=md-nav__item> <a href=../terraform class=md-nav__link> <span class=md-ellipsis> 🏗️ Terraform Module </span> </a> </li> <li class=md-nav__item> <a href=../systemd class=md-nav__link> <span class=md-ellipsis> ⚙️ Systemd Module </span> </a> </li> <li class=md-nav__item> <a href=../aws class=md-nav__link> <span class=md-ellipsis> ☁️ AWS </span> </a> </li> <li class=md-nav__item> <a href=../azure class=md-nav__link> <span class=md-ellipsis> 🔷 Azure </span> </a> </li> <li class=md-nav__item> <a href=../gcp class=md-nav__link> <span class=md-ellipsis> 🌩️ GCP </span> </a> </li> <li class=md-nav__item> <a href=../digitalocean class=md-nav__link> <span class=md-ellipsis> 🌊 DigitalOcean </span> </a> </li> <li class=md-nav__item> <a href=../docker class=md-nav__link> <span class=md-ellipsis> 🐳 Docker </span> </a> </li> <li class=md-nav__item> <a href=../pulumi class=md-nav__link> <span class=md-ellipsis> 🏗️ Pulumi </span> </a> </li> <li class=md-nav__item> <a href=../salt class=md-nav__link> <span class=md-ellipsis> 🧂 SaltStack </span> </a> </li> <li class=md-nav__item> <a href=../notifications class=md-nav__link> <span class=md-ellipsis> 🔔 Notifications </span> </a> </li> <li class=md-nav__item> <a href=../state class=md-nav__link> <span class=md-ellipsis> 💾 State Module </span> </a> </li> <li class=md-nav__item> <a href=../../en/plugin-development class=md-nav__link> <span class=md-ellipsis> 🔧 Lua API </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> 🗄️ State Management </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> 🗄️ State Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../state-management class=md-nav__link> <span class=md-ellipsis> 📋 State Management Guide 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../idempotency class=md-nav__link> <span class=md-ellipsis> 🔄 Idempotency </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> 📖 Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> 📖 Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/values-delegate-to class=md-nav__link> <span class=md-ellipsis> ✨ Using Values with delegate_to 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../features/user-field class=md-nav__link> <span class=md-ellipsis> 👤 Running Tasks as Different Users 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../features/sloth-management class=md-nav__link> <span class=md-ellipsis> 🦥 Sloth Management (Saved Workflows) 🔥 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../en/advanced-examples class=md-nav__link> <span class=md-ellipsis> 🎭 Examples </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> ⚡ Enterprise Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> ⚡ Enterprise Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../en/ai-features class=md-nav__link> <span class=md-ellipsis> 🤖 AI Integration </span> </a> </li> <li class=md-nav__item> <a href=../../en/distributed class=md-nav__link> <span class=md-ellipsis> 🌐 Distributed Agents </span> </a> </li> <li class=md-nav__item> <a href=../../en/master-agent-architecture class=md-nav__link> <span class=md-ellipsis> 🤖 Agent Setup Guide </span> </a> </li> <li class=md-nav__item> <a href=../../en/agent-improvements class=md-nav__link> <span class=md-ellipsis> 🔄 Agent Auto-Reconnection 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../pt/agente-em-containers class=md-nav__link> <span class=md-ellipsis> 📦 Agents in Incus/LXC Containers </span> </a> </li> <li class=md-nav__item> <a href=../../en/monitoring class=md-nav__link> <span class=md-ellipsis> 📊 Web Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../../pt/scheduler class=md-nav__link> <span class=md-ellipsis> ⏰ Advanced Scheduler </span> </a> </li> <li class=md-nav__item> <a href=../../en/enterprise-features class=md-nav__link> <span class=md-ellipsis> ☁️ Multi-Cloud </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_10_9> <label class=md-nav__link for=__nav_10_9 id=__nav_10_9_label tabindex=0> <span class=md-ellipsis> 📈 Telemetry & Observability 🔥 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_9_label aria-expanded=false> <label class=md-nav__title for=__nav_10_9> <span class="md-nav__icon md-icon"></span> 📈 Telemetry & Observability 🔥 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../en/telemetry/index class=md-nav__link> <span class=md-ellipsis> 📊 Overview </span> </a> </li> <li class=md-nav__item> <a href=../../en/telemetry/prometheus-metrics class=md-nav__link> <span class=md-ellipsis> 📈 Prometheus Metrics </span> </a> </li> <li class=md-nav__item> <a href=../../en/telemetry/grafana-dashboard class=md-nav__link> <span class=md-ellipsis> 💻 Grafana Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../../en/telemetry/deployment class=md-nav__link> <span class=md-ellipsis> 🚀 Deployment Guide </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> 🧪 Testing & Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> 🧪 Testing & Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../en/testing class=md-nav__link> <span class=md-ellipsis> 🧪 Testing </span> </a> </li> <li class=md-nav__item> <a href=../../en/repl class=md-nav__link> <span class=md-ellipsis> 💻 REPL </span> </a> </li> <li class=md-nav__item> <a href=../../en/nvim-plugin class=md-nav__link> <span class=md-ellipsis> 🦥 Neovim Plugin </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> 🇺🇸 English </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> 🇺🇸 English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../en/getting-started class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../en/core-concepts class=md-nav__link> <span class=md-ellipsis> Core Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../en/quick-start class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../en/ai-features class=md-nav__link> <span class=md-ellipsis> AI Features </span> </a> </li> <li class=md-nav__item> <a href=../../en/gitops-features class=md-nav__link> <span class=md-ellipsis> GitOps </span> </a> </li> <li class=md-nav__item> <a href=../../en/enterprise-features class=md-nav__link> <span class=md-ellipsis> Enterprise </span> </a> </li> <li class=md-nav__item> <a href=../../en/CLI class=md-nav__link> <span class=md-ellipsis> CLI </span> </a> </li> <li class=md-nav__item> <a href=../../en/repl class=md-nav__link> <span class=md-ellipsis> REPL </span> </a> </li> <li class=md-nav__item> <a href=../../en/advanced-examples class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../en/distributed class=md-nav__link> <span class=md-ellipsis> Distributed </span> </a> </li> <li class=md-nav__item> <a href=../../en/master-agent-architecture class=md-nav__link> <span class=md-ellipsis> Master-Agent </span> </a> </li> <li class=md-nav__item> <a href=../../en/enhanced-agent-output class=md-nav__link> <span class=md-ellipsis> Agent Output </span> </a> </li> <li class=md-nav__item> <a href=../../en/agent-improvements class=md-nav__link> <span class=md-ellipsis> Agent Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../en/nvim-plugin class=md-nav__link> <span class=md-ellipsis> Plugin </span> </a> </li> <li class=md-nav__item> <a href=../../en/contributing class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_13> <label class=md-nav__link for=__nav_13 id=__nav_13_label tabindex=0> <span class=md-ellipsis> 🇧🇷 Português </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_13_label aria-expanded=false> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> 🇧🇷 Português </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../pt/getting-started class=md-nav__link> <span class=md-ellipsis> Instalação </span> </a> </li> <li class=md-nav__item> <a href=../../pt/core-concepts class=md-nav__link> <span class=md-ellipsis> Conceitos </span> </a> </li> <li class=md-nav__item> <a href=../../pt/CLI class=md-nav__link> <span class=md-ellipsis> CLI </span> </a> </li> <li class=md-nav__item> <a href=../../pt/repl class=md-nav__link> <span class=md-ellipsis> REPL </span> </a> </li> <li class=md-nav__item> <a href=../../pt/advanced-features class=md-nav__link> <span class=md-ellipsis> Avançado </span> </a> </li> <li class=md-nav__item> <a href=../../pt/advanced-examples class=md-nav__link> <span class=md-ellipsis> Exemplos </span> </a> </li> <li class=md-nav__item> <a href=../../pt/distributed class=md-nav__link> <span class=md-ellipsis> Distribuído </span> </a> </li> <li class=md-nav__item> <a href=../../pt/agente-em-containers class=md-nav__link> <span class=md-ellipsis> Agentes em Containers </span> </a> </li> <li class=md-nav__item> <a href=../../pt/scheduler class=md-nav__link> <span class=md-ellipsis> Scheduler </span> </a> </li> <li class=md-nav__item> <a href=../../pt/telemetria/index class=md-nav__link> <span class=md-ellipsis> Telemetria 🔥 </span> </a> </li> <li class=md-nav__item> <a href=../../pt/testing class=md-nav__link> <span class=md-ellipsis> Testes </span> </a> </li> <li class=md-nav__item> <a href=../../pt/plugin-development class=md-nav__link> <span class=md-ellipsis> Plugin Dev </span> </a> </li> <li class=md-nav__item> <a href=../../pt/nvim-plugin class=md-nav__link> <span class=md-ellipsis> Nvim Plugin </span> </a> </li> <li class=md-nav__item> <a href=../../pt/contributing class=md-nav__link> <span class=md-ellipsis> Contribuir </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_14> <label class=md-nav__link for=__nav_14 id=__nav_14_label tabindex=0> <span class=md-ellipsis> 🇨🇳 中文 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_14_label aria-expanded=false> <label class=md-nav__title for=__nav_14> <span class="md-nav__icon md-icon"></span> 🇨🇳 中文 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../zh/getting-started class=md-nav__link> <span class=md-ellipsis> 安装 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/core-concepts class=md-nav__link> <span class=md-ellipsis> 核心概念 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/CLI class=md-nav__link> <span class=md-ellipsis> CLI </span> </a> </li> <li class=md-nav__item> <a href=../../zh/repl class=md-nav__link> <span class=md-ellipsis> REPL </span> </a> </li> <li class=md-nav__item> <a href=../../zh/advanced-features class=md-nav__link> <span class=md-ellipsis> 高级功能 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/advanced-examples class=md-nav__link> <span class=md-ellipsis> 示例 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/distributed class=md-nav__link> <span class=md-ellipsis> 分布式 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/scheduler class=md-nav__link> <span class=md-ellipsis> 调度器 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/testing class=md-nav__link> <span class=md-ellipsis> 测试 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/plugin-development class=md-nav__link> <span class=md-ellipsis> 插件开发 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/nvim-plugin class=md-nav__link> <span class=md-ellipsis> Nvim插件 </span> </a> </li> <li class=md-nav__item> <a href=../../zh/contributing class=md-nav__link> <span class=md-ellipsis> 贡献 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Page contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Page contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=#core-functions class=md-nav__link> <span class=md-ellipsis> Core Functions </span> </a> <nav class=md-nav aria-label="Core Functions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#factsget_all class=md-nav__link> <span class=md-ellipsis> facts.get_all() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_hostname class=md-nav__link> <span class=md-ellipsis> facts.get_hostname() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_platform class=md-nav__link> <span class=md-ellipsis> facts.get_platform() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_memory class=md-nav__link> <span class=md-ellipsis> facts.get_memory() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_disk class=md-nav__link> <span class=md-ellipsis> facts.get_disk() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_network class=md-nav__link> <span class=md-ellipsis> facts.get_network() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_packages class=md-nav__link> <span class=md-ellipsis> facts.get_packages() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_package class=md-nav__link> <span class=md-ellipsis> facts.get_package() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_services class=md-nav__link> <span class=md-ellipsis> facts.get_services() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_service class=md-nav__link> <span class=md-ellipsis> facts.get_service() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_users class=md-nav__link> <span class=md-ellipsis> facts.get_users() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_user class=md-nav__link> <span class=md-ellipsis> facts.get_user() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_processes class=md-nav__link> <span class=md-ellipsis> facts.get_processes() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_mounts class=md-nav__link> <span class=md-ellipsis> facts.get_mounts() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_uptime class=md-nav__link> <span class=md-ellipsis> facts.get_uptime() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_load class=md-nav__link> <span class=md-ellipsis> facts.get_load() </span> </a> </li> <li class=md-nav__item> <a href=#factsget_kernel class=md-nav__link> <span class=md-ellipsis> facts.get_kernel() </span> </a> </li> <li class=md-nav__item> <a href=#factsquery class=md-nav__link> <span class=md-ellipsis> facts.query() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exemplo-destacado-validacao-e-deploy-inteligente class=md-nav__link> <span class=md-ellipsis> 🔥 Exemplo Destacado: Validação e Deploy Inteligente </span> </a> </li> <li class=md-nav__item> <a href=#complete-examples class=md-nav__link> <span class=md-ellipsis> Complete Examples </span> </a> <nav class=md-nav aria-label="Complete Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-1-pre-deployment-system-validation class=md-nav__link> <span class=md-ellipsis> Example 1: Pre-deployment System Validation </span> </a> </li> <li class=md-nav__item> <a href=#example-2-dynamic-inventory-based-on-facts class=md-nav__link> <span class=md-ellipsis> Example 2: Dynamic Inventory Based on Facts </span> </a> </li> <li class=md-nav__item> <a href=#example-3-conditional-deployment-based-on-system-state class=md-nav__link> <span class=md-ellipsis> Example 3: Conditional Deployment Based on System State </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#see-also class=md-nav__link> <span class=md-ellipsis> See Also </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/chalkan3-sloth/sloth-runner/edit/master/docs/modules/facts.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/chalkan3-sloth/sloth-runner/raw/master/docs/modules/facts.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=facts-module>Facts Module<a class=headerlink href=#facts-module title="Permanent link">&para;</a></h1> <p>The <code>facts</code> module provides access to system information collected from agents by the Sloth Runner master. This allows you to query detailed information about remote systems, including hardware specs, installed packages, running services, and more.</p> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>The facts module communicates with the Sloth Runner master to retrieve cached system information that agents periodically collect and report. This enables infrastructure discovery, validation, and conditional task execution based on real-time system state.</p> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">&para;</a></h2> <p>The <code>facts</code> module is automatically available as a global module in all Sloth Runner tasks. No <code>require</code> statement is needed.</p> <h2 id=core-functions>Core Functions<a class=headerlink href=#core-functions title="Permanent link">&para;</a></h2> <h3 id=factsget_all>facts.get_all()<a class=headerlink href=#factsget_all title="Permanent link">&para;</a></h3> <p>Retrieves all facts from an agent.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kd>local</span><span class=w> </span><span class=nv>info</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_all</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Parameters:</strong> - <code>agent</code> (string): The name of the agent to query</p> <p><strong>Returns:</strong> - Table containing all system information, or nil on error - Error message if operation failed</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_system&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>info</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_all</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-server-01&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed to get facts: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Hostname: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>hostname</span><span class=p>)</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Platform: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>platform</span><span class=p>)</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;CPUs: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>cpus</span><span class=p>)</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Memory Total: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>memory</span><span class=p>.</span><span class=py>total</span><span class=p>)</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_hostname>facts.get_hostname()<a class=headerlink href=#factsget_hostname title="Permanent link">&para;</a></h3> <p>Gets the hostname of an agent.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kd>local</span><span class=w> </span><span class=nv>hostname</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_hostname</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_hostname&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>hostname</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_hostname</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;web-01&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Hostname: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>hostname</span><span class=p>)</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_platform>facts.get_platform()<a class=headerlink href=#factsget_platform title="Permanent link">&para;</a></h3> <p>Gets platform information (OS, kernel, architecture).</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kd>local</span><span class=w> </span><span class=nv>platform</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_platform</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table with fields: - <code>os</code>: Operating system name - <code>family</code>: Platform family (e.g., "debian", "redhat") - <code>version</code>: OS version - <code>architecture</code>: System architecture (e.g., "amd64", "arm64") - <code>kernel</code>: Kernel name - <code>kernel_version</code>: Kernel version - <code>virtualization</code>: Virtualization technology (if any)</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_os&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>platform</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_platform</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;db-server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;OS: %s %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>os</span><span class=p>,</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>version</span><span class=p>))</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Arch: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>architecture</span><span class=p>))</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Kernel: %s %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>kernel</span><span class=p>,</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>kernel_version</span><span class=p>))</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>virtualization</span><span class=w> </span><span class=o>~=</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Running on: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>virtualization</span><span class=p>)</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_memory>facts.get_memory()<a class=headerlink href=#factsget_memory title="Permanent link">&para;</a></h3> <p>Gets memory information.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kd>local</span><span class=w> </span><span class=nv>memory</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_memory</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table with fields: - <code>total</code>: Total memory in bytes - <code>available</code>: Available memory in bytes - <code>used</code>: Used memory in bytes - <code>used_percent</code>: Memory usage percentage - <code>free</code>: Free memory in bytes - <code>cached</code>: Cached memory in bytes - <code>buffers</code>: Buffer memory in bytes</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_memory&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>mem</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_memory</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;app-server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>total_gb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>mem</span><span class=p>.</span><span class=py>total</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>used_gb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>mem</span><span class=p>.</span><span class=py>used</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Memory: %.2f GB / %.2f GB (%.1f%%)&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>        </span><span class=nv>used_gb</span><span class=p>,</span><span class=w> </span><span class=nv>total_gb</span><span class=p>,</span><span class=w> </span><span class=nv>mem</span><span class=p>.</span><span class=py>used_percent</span><span class=p>))</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>mem</span><span class=p>.</span><span class=py>used_percent</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>90</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;WARNING: Memory usage is critical!&quot;</span><span class=p>)</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_disk>facts.get_disk()<a class=headerlink href=#factsget_disk title="Permanent link">&para;</a></h3> <p>Gets disk/filesystem information.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>-- Get all disks</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=kd>local</span><span class=w> </span><span class=nv>disks</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_disk</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=c1>-- Get specific mountpoint</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=kd>local</span><span class=w> </span><span class=nv>disk</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_disk</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>    </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>    </span><span class=nv>mountpoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/home&quot;</span><span class=w> </span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> - Array of disk information (if no mountpoint specified) - Single disk table (if mountpoint specified)</p> <p>Each disk table contains: - <code>device</code>: Device name - <code>mountpoint</code>: Mount path - <code>fstype</code>: Filesystem type - <code>total</code>: Total space in bytes - <code>used</code>: Used space in bytes - <code>free</code>: Free space in bytes - <code>used_percent</code>: Usage percentage</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_disk_space&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>disks</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_disk</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;file-server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>    </span><span class=kr>for</span><span class=w> </span><span class=nv>i</span><span class=p>,</span><span class=w> </span><span class=nv>disk</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>disks</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>used_gb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>disk</span><span class=p>.</span><span class=py>used</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>total_gb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>disk</span><span class=p>.</span><span class=py>total</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;%s: %.2f GB / %.2f GB (%.1f%%)&quot;</span><span class=p>,</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>            </span><span class=nv>disk</span><span class=p>.</span><span class=py>mountpoint</span><span class=p>,</span><span class=w> </span><span class=nv>used_gb</span><span class=p>,</span><span class=w> </span><span class=nv>total_gb</span><span class=p>,</span><span class=w> </span><span class=nv>disk</span><span class=p>.</span><span class=py>used_percent</span><span class=p>))</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=nv>disk</span><span class=p>.</span><span class=py>used_percent</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>85</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>            </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;  WARNING: Low disk space!&quot;</span><span class=p>)</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_network>facts.get_network()<a class=headerlink href=#factsget_network title="Permanent link">&para;</a></h3> <p>Gets network interface information.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1>-- Get all interfaces</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=kd>local</span><span class=w> </span><span class=nv>interfaces</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_network</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=c1>-- Get specific interface</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=kd>local</span><span class=w> </span><span class=nv>iface</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_network</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>    </span><span class=nv>interface</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eth0&quot;</span><span class=w> </span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table or array of tables with fields: - <code>name</code>: Interface name - <code>mac</code>: MAC address - <code>mtu</code>: MTU size - <code>is_up</code>: Interface status (boolean) - <code>speed</code>: Link speed - <code>addresses</code>: Array of IP addresses</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_network&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>ifaces</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_network</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;router&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>    </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>iface</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>ifaces</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Interface: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>iface</span><span class=p>.</span><span class=py>name</span><span class=p>))</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;  MAC: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>iface</span><span class=p>.</span><span class=py>mac</span><span class=p>))</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;  Status: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>iface</span><span class=p>.</span><span class=py>is_up</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=s2>&quot;UP&quot;</span><span class=w> </span><span class=ow>or</span><span class=w> </span><span class=s2>&quot;DOWN&quot;</span><span class=p>))</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;  IPs:&quot;</span><span class=p>)</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>        </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>addr</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>iface</span><span class=p>.</span><span class=py>addresses</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>            </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;    - &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>addr</span><span class=p>)</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_packages>facts.get_packages()<a class=headerlink href=#factsget_packages title="Permanent link">&para;</a></h3> <p>Gets information about installed packages.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kd>local</span><span class=w> </span><span class=nv>pkg_info</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_packages</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table with fields: - <code>manager</code>: Package manager name - <code>installed_count</code>: Number of installed packages - <code>updates_available</code>: Number of available updates - <code>packages</code>: Array of installed packages - <code>updates</code>: Array of available updates</p> <p>Each package contains: - <code>name</code>: Package name - <code>version</code>: Installed version - <code>architecture</code>: Package architecture - <code>description</code>: Package description</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_packages&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>pkgs</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_packages</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server-01&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Package Manager: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>pkgs</span><span class=p>.</span><span class=py>manager</span><span class=p>))</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Installed Packages: %d&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>pkgs</span><span class=p>.</span><span class=py>installed_count</span><span class=p>))</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Updates Available: %d&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>pkgs</span><span class=p>.</span><span class=py>updates_available</span><span class=p>))</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>pkgs</span><span class=p>.</span><span class=py>updates_available</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Available Updates:&quot;</span><span class=p>)</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>        </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>upd</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>pkgs</span><span class=p>.</span><span class=py>updates</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>            </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;  - %s: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>upd</span><span class=p>.</span><span class=py>name</span><span class=p>,</span><span class=w> </span><span class=nv>upd</span><span class=p>.</span><span class=py>version</span><span class=p>))</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_package>facts.get_package()<a class=headerlink href=#factsget_package title="Permanent link">&para;</a></h3> <p>Checks if a specific package is installed.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=kd>local</span><span class=w> </span><span class=nv>pkg</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_package</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=w>    </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>    </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;package-name&quot;</span><span class=w> </span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table with fields: - <code>name</code>: Package name - <code>installed</code>: Boolean indicating if package is installed - <code>version</code>: Installed version (if installed) - <code>architecture</code>: Package architecture (if installed) - <code>description</code>: Package description (if installed)</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;ensure_nginx&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>pkg</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_package</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>        </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;web-server&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>        </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;nginx&quot;</span><span class=w> </span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>pkg</span><span class=p>.</span><span class=py>installed</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;nginx %s is installed&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>pkg</span><span class=p>.</span><span class=py>version</span><span class=p>))</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>    </span><span class=kr>else</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;nginx is not installed - installing...&quot;</span><span class=p>)</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=w>        </span><span class=nv>pkg</span><span class=p>.</span><span class=nf>install</span><span class=p>({</span><span class=w> </span><span class=nv>packages</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s2>&quot;nginx&quot;</span><span class=p>}</span><span class=w> </span><span class=p>}):</span><span class=nf>delegate_to</span><span class=p>(</span><span class=s2>&quot;web-server&quot;</span><span class=p>)</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_services>facts.get_services()<a class=headerlink href=#factsget_services title="Permanent link">&para;</a></h3> <p>Gets information about all services.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=kd>local</span><span class=w> </span><span class=nv>services</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_services</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Array of service tables with fields: - <code>name</code>: Service name - <code>status</code>: Service status - <code>state</code>: Service state</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;list_services&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>services</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_services</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;app-server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Active Services:&quot;</span><span class=p>)</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>    </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>svc</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>services</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=nv>svc</span><span class=p>.</span><span class=py>status</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;active&quot;</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>            </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;  - %s: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>svc</span><span class=p>.</span><span class=py>name</span><span class=p>,</span><span class=w> </span><span class=nv>svc</span><span class=p>.</span><span class=py>state</span><span class=p>))</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_service>facts.get_service()<a class=headerlink href=#factsget_service title="Permanent link">&para;</a></h3> <p>Gets status of a specific service.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kd>local</span><span class=w> </span><span class=nv>service</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_service</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>    </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>    </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;service-name&quot;</span><span class=w> </span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_nginx_status&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>svc</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_service</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>        </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;web-01&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>        </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;nginx&quot;</span><span class=w> </span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;nginx: %s (%s)&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>svc</span><span class=p>.</span><span class=py>status</span><span class=p>,</span><span class=w> </span><span class=nv>svc</span><span class=p>.</span><span class=py>state</span><span class=p>))</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>svc</span><span class=p>.</span><span class=py>status</span><span class=w> </span><span class=o>~=</span><span class=w> </span><span class=s2>&quot;active&quot;</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;WARNING: nginx is not active!&quot;</span><span class=p>)</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_users>facts.get_users()<a class=headerlink href=#factsget_users title="Permanent link">&para;</a></h3> <p>Gets information about system users.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=kd>local</span><span class=w> </span><span class=nv>users</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_users</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Array of user tables with fields: - <code>username</code>: User name - <code>uid</code>: User ID - <code>gid</code>: Group ID - <code>home</code>: Home directory - <code>shell</code>: Login shell</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;list_users&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>users</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_users</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;System Users:&quot;</span><span class=p>)</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>    </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>user</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>users</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;  %s (UID: %s) - %s&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=w>            </span><span class=nv>user</span><span class=p>.</span><span class=py>username</span><span class=p>,</span><span class=w> </span><span class=nv>user</span><span class=p>.</span><span class=py>uid</span><span class=p>,</span><span class=w> </span><span class=nv>user</span><span class=p>.</span><span class=py>shell</span><span class=p>))</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_user>facts.get_user()<a class=headerlink href=#factsget_user title="Permanent link">&para;</a></h3> <p>Gets information about a specific user.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=kd>local</span><span class=w> </span><span class=nv>user</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_user</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>    </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>    </span><span class=nv>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;username&quot;</span><span class=w> </span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_user&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>user</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_user</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>        </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>        </span><span class=nv>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;deploy&quot;</span><span class=w> </span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;User &#39;deploy&#39; not found&quot;</span><span class=p>)</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>        </span><span class=c1>-- Create user</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>        </span><span class=nv>user</span><span class=p>.</span><span class=nf>create</span><span class=p>({</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>            </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;deploy&quot;</span><span class=p>,</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>            </span><span class=nv>home</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/home/deploy&quot;</span><span class=p>,</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>            </span><span class=nv>shell</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/bin/bash&quot;</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=w>        </span><span class=p>}):</span><span class=nf>delegate_to</span><span class=p>(</span><span class=s2>&quot;server&quot;</span><span class=p>)</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=w>    </span><span class=kr>else</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;User &#39;deploy&#39; exists: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>user</span><span class=p>.</span><span class=py>home</span><span class=p>))</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_processes>facts.get_processes()<a class=headerlink href=#factsget_processes title="Permanent link">&para;</a></h3> <p>Gets process statistics.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=kd>local</span><span class=w> </span><span class=nv>procs</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_processes</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table with fields: - <code>total</code>: Total number of processes - <code>running</code>: Running processes - <code>sleeping</code>: Sleeping processes - <code>zombie</code>: Zombie processes</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_processes&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>procs</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_processes</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Processes: %d total, %d running, %d sleeping&quot;</span><span class=p>,</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>        </span><span class=nv>procs</span><span class=p>.</span><span class=py>total</span><span class=p>,</span><span class=w> </span><span class=nv>procs</span><span class=p>.</span><span class=py>running</span><span class=p>,</span><span class=w> </span><span class=nv>procs</span><span class=p>.</span><span class=py>sleeping</span><span class=p>))</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>procs</span><span class=p>.</span><span class=py>zombie</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;WARNING: %d zombie processes!&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>procs</span><span class=p>.</span><span class=py>zombie</span><span class=p>))</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_mounts>facts.get_mounts()<a class=headerlink href=#factsget_mounts title="Permanent link">&para;</a></h3> <p>Gets filesystem mount information.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=kd>local</span><span class=w> </span><span class=nv>mounts</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_mounts</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Array of mount tables with fields: - <code>device</code>: Device name - <code>mountpoint</code>: Mount path - <code>fstype</code>: Filesystem type - <code>options</code>: Mount options</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;list_mounts&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>mounts</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_mounts</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Mounted Filesystems:&quot;</span><span class=p>)</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>    </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>mount</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>mounts</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;  %s on %s type %s (%s)&quot;</span><span class=p>,</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=w>            </span><span class=nv>mount</span><span class=p>.</span><span class=py>device</span><span class=p>,</span><span class=w> </span><span class=nv>mount</span><span class=p>.</span><span class=py>mountpoint</span><span class=p>,</span><span class=w> </span><span class=nv>mount</span><span class=p>.</span><span class=py>fstype</span><span class=p>,</span><span class=w> </span><span class=nv>mount</span><span class=p>.</span><span class=py>options</span><span class=p>))</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_uptime>facts.get_uptime()<a class=headerlink href=#factsget_uptime title="Permanent link">&para;</a></h3> <p>Gets system uptime information.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=kd>local</span><span class=w> </span><span class=nv>uptime</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_uptime</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table with fields: - <code>seconds</code>: Uptime in seconds - <code>boot_time</code>: Boot time (Unix timestamp) - <code>timezone</code>: System timezone</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_uptime&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>uptime</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_uptime</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>days</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>math.floor</span><span class=p>(</span><span class=nv>uptime</span><span class=p>.</span><span class=py>seconds</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>86400</span><span class=p>)</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>hours</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>math.floor</span><span class=p>((</span><span class=nv>uptime</span><span class=p>.</span><span class=py>seconds</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>86400</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>3600</span><span class=p>)</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>mins</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>math.floor</span><span class=p>((</span><span class=nv>uptime</span><span class=p>.</span><span class=py>seconds</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>3600</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>60</span><span class=p>)</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Uptime: %d days, %d hours, %d minutes&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=w>        </span><span class=nv>days</span><span class=p>,</span><span class=w> </span><span class=nv>hours</span><span class=p>,</span><span class=w> </span><span class=nv>mins</span><span class=p>))</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Timezone: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>uptime</span><span class=p>.</span><span class=py>timezone</span><span class=p>))</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_load>facts.get_load()<a class=headerlink href=#factsget_load title="Permanent link">&para;</a></h3> <p>Gets system load average.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=kd>local</span><span class=w> </span><span class=nb>load</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_load</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Array with load averages [1min, 5min, 15min]</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_load&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nb>load</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_load</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Load Average: %.2f, %.2f, %.2f&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>        </span><span class=nb>load</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=nb>load</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=w> </span><span class=nb>load</span><span class=p>[</span><span class=mi>3</span><span class=p>]))</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nb>load</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>4.0</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;WARNING: High load!&quot;</span><span class=p>)</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsget_kernel>facts.get_kernel()<a class=headerlink href=#factsget_kernel title="Permanent link">&para;</a></h3> <p>Gets kernel information.</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=kd>local</span><span class=w> </span><span class=nv>kernel</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_kernel</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Returns:</strong> Table with fields: - <code>name</code>: Kernel name - <code>version</code>: Kernel version</p> <p><strong>Example:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;check_kernel&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>kernel</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_kernel</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;server&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Failed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Kernel: %s %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>kernel</span><span class=p>.</span><span class=py>name</span><span class=p>,</span><span class=w> </span><span class=nv>kernel</span><span class=p>.</span><span class=py>version</span><span class=p>))</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=factsquery>facts.query()<a class=headerlink href=#factsquery title="Permanent link">&para;</a></h3> <p>Performs a query on facts (experimental).</p> <p><strong>Syntax:</strong> <div class="language-lua highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=kd>local</span><span class=w> </span><span class=nv>result</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>query</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=w>    </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;agent-name&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=w>    </span><span class=nv>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;$.memory.total&quot;</span><span class=w> </span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=p>})</span>
</span></code></pre></div></p> <p><strong>Note:</strong> This function is experimental and may change in future versions.</p> <h2 id=exemplo-destacado-validacao-e-deploy-inteligente>🔥 Exemplo Destacado: Validação e Deploy Inteligente<a class=headerlink href=#exemplo-destacado-validacao-e-deploy-inteligente title="Permanent link">&para;</a></h2> <p>Este exemplo demonstra como usar facts para tomar decisões inteligentes durante o deploy, validando o sistema alvo e adaptando o comportamento baseado nas condições reais.</p> <div class="language-lua highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=nf>task</span><span class=p>({</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=w>    </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;intelligent-deploy&quot;</span><span class=p>,</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=w>    </span><span class=nv>run</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>target_agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>values</span><span class=p>.</span><span class=py>target</span><span class=w> </span><span class=ow>or</span><span class=w> </span><span class=s2>&quot;prod-server-01&quot;</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>        </span><span class=c1>-- 📊 Coletar informações do sistema alvo</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>info</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_all</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>target_agent</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=w>            </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;❌ Cannot reach agent: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span>
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-35-11><a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a>
</span><span id=__span-35-12><a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a><span class=w>        </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;🔍 Analyzing &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>hostname</span><span class=p>)</span>
</span><span id=__span-35-13><a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a><span class=w>        </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;   Platform: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>platform</span><span class=p>.</span><span class=py>os</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>platform</span><span class=p>.</span><span class=py>version</span><span class=p>)</span>
</span><span id=__span-35-14><a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a><span class=w>        </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;   Memory: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;%.2f GB&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>memory</span><span class=p>.</span><span class=py>total</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=p>))</span>
</span><span id=__span-35-15><a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a><span class=w>        </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;   Arch: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>platform</span><span class=p>.</span><span class=py>architecture</span><span class=p>)</span>
</span><span id=__span-35-16><a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a>
</span><span id=__span-35-17><a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=w>        </span><span class=c1>-- ✅ Validação de requisitos mínimos</span>
</span><span id=__span-35-18><a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>mem_gb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>memory</span><span class=p>.</span><span class=py>total</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span>
</span><span id=__span-35-19><a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=nv>mem_gb</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-35-20><a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a><span class=w>            </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;❌ Insufficient memory: need 4GB, have &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;%.2f GB&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>mem_gb</span><span class=p>))</span>
</span><span id=__span-35-21><a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-35-22><a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a>
</span><span id=__span-35-23><a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a><span class=w>        </span><span class=c1>-- ✅ Verificar espaço em disco</span>
</span><span id=__span-35-24><a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>root_disk</span><span class=p>,</span><span class=w> </span><span class=nv>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_disk</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-35-25><a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=w>            </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>target_agent</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-35-26><a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a><span class=w>            </span><span class=nv>mountpoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/&quot;</span><span class=w> </span>
</span><span id=__span-35-27><a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a><span class=w>        </span><span class=p>})</span>
</span><span id=__span-35-28><a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=nv>root_disk</span><span class=p>.</span><span class=py>used_percent</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>85</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-35-29><a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a><span class=w>            </span><span class=nv>log</span><span class=p>.</span><span class=nf>warn</span><span class=p>(</span><span class=s2>&quot;⚠️  Disk usage high: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>root_disk</span><span class=p>.</span><span class=py>used_percent</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=s2>&quot;%&quot;</span><span class=p>)</span>
</span><span id=__span-35-30><a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-35-31><a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a>
</span><span id=__span-35-32><a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a><span class=w>        </span><span class=c1>-- ✅ Verificar se Docker já está instalado</span>
</span><span id=__span-35-33><a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>docker_pkg</span><span class=p>,</span><span class=w> </span><span class=nv>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_package</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-35-34><a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a><span class=w>            </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>target_agent</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-35-35><a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a><span class=w>            </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;docker&quot;</span><span class=w> </span>
</span><span id=__span-35-36><a id=__codelineno-35-36 name=__codelineno-35-36 href=#__codelineno-35-36></a><span class=w>        </span><span class=p>})</span>
</span><span id=__span-35-37><a id=__codelineno-35-37 name=__codelineno-35-37 href=#__codelineno-35-37></a>
</span><span id=__span-35-38><a id=__codelineno-35-38 name=__codelineno-35-38 href=#__codelineno-35-38></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=ow>not</span><span class=w> </span><span class=nv>docker_pkg</span><span class=p>.</span><span class=py>installed</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-35-39><a id=__codelineno-35-39 name=__codelineno-35-39 href=#__codelineno-35-39></a><span class=w>            </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;📦 Installing Docker...&quot;</span><span class=p>)</span>
</span><span id=__span-35-40><a id=__codelineno-35-40 name=__codelineno-35-40 href=#__codelineno-35-40></a><span class=w>            </span><span class=nv>pkg</span><span class=p>.</span><span class=nf>install</span><span class=p>({</span><span class=w> </span><span class=nv>packages</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s2>&quot;docker.io&quot;</span><span class=p>}</span><span class=w> </span><span class=p>}):</span><span class=nf>delegate_to</span><span class=p>(</span><span class=nv>target_agent</span><span class=p>)</span>
</span><span id=__span-35-41><a id=__codelineno-35-41 name=__codelineno-35-41 href=#__codelineno-35-41></a><span class=w>        </span><span class=kr>else</span>
</span><span id=__span-35-42><a id=__codelineno-35-42 name=__codelineno-35-42 href=#__codelineno-35-42></a><span class=w>            </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;✅ Docker already installed: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>docker_pkg</span><span class=p>.</span><span class=py>version</span><span class=p>)</span>
</span><span id=__span-35-43><a id=__codelineno-35-43 name=__codelineno-35-43 href=#__codelineno-35-43></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-35-44><a id=__codelineno-35-44 name=__codelineno-35-44 href=#__codelineno-35-44></a>
</span><span id=__span-35-45><a id=__codelineno-35-45 name=__codelineno-35-45 href=#__codelineno-35-45></a><span class=w>        </span><span class=c1>-- 🚀 Deploy baseado na arquitetura</span>
</span><span id=__span-35-46><a id=__codelineno-35-46 name=__codelineno-35-46 href=#__codelineno-35-46></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>image_tag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;latest&quot;</span>
</span><span id=__span-35-47><a id=__codelineno-35-47 name=__codelineno-35-47 href=#__codelineno-35-47></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=nv>info</span><span class=p>.</span><span class=py>platform</span><span class=p>.</span><span class=py>architecture</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;arm64&quot;</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-35-48><a id=__codelineno-35-48 name=__codelineno-35-48 href=#__codelineno-35-48></a><span class=w>            </span><span class=nv>image_tag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;latest-arm64&quot;</span>
</span><span id=__span-35-49><a id=__codelineno-35-49 name=__codelineno-35-49 href=#__codelineno-35-49></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-35-50><a id=__codelineno-35-50 name=__codelineno-35-50 href=#__codelineno-35-50></a>
</span><span id=__span-35-51><a id=__codelineno-35-51 name=__codelineno-35-51 href=#__codelineno-35-51></a><span class=w>        </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;🚀 Deploying with image: myapp:&quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>image_tag</span><span class=p>)</span>
</span><span id=__span-35-52><a id=__codelineno-35-52 name=__codelineno-35-52 href=#__codelineno-35-52></a>
</span><span id=__span-35-53><a id=__codelineno-35-53 name=__codelineno-35-53 href=#__codelineno-35-53></a><span class=w>        </span><span class=c1>-- Continue with deployment...</span>
</span><span id=__span-35-54><a id=__codelineno-35-54 name=__codelineno-35-54 href=#__codelineno-35-54></a><span class=w>        </span><span class=nv>log</span><span class=p>.</span><span class=nf>info</span><span class=p>(</span><span class=s2>&quot;✅ Deploy completed successfully!&quot;</span><span class=p>)</span>
</span><span id=__span-35-55><a id=__codelineno-35-55 name=__codelineno-35-55 href=#__codelineno-35-55></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-35-56><a id=__codelineno-35-56 name=__codelineno-35-56 href=#__codelineno-35-56></a><span class=p>})</span>
</span></code></pre></div> <p><strong>Recursos demonstrados:</strong></p> <ul> <li>📊 Coleta completa de informações do sistema remoto</li> <li>✅ Validação de requisitos (memória, disco, pacotes)</li> <li>🧠 Deploy condicional baseado em arquitetura (x86/ARM)</li> <li>🔄 Instalação automática de dependências</li> <li>🎯 Uso de <code>values</code> para parametrização</li> </ul> <hr> <h2 id=complete-examples>Complete Examples<a class=headerlink href=#complete-examples title="Permanent link">&para;</a></h2> <h3 id=example-1-pre-deployment-system-validation>Example 1: Pre-deployment System Validation<a class=headerlink href=#example-1-pre-deployment-system-validation title="Permanent link">&para;</a></h3> <div class="language-lua highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;validate_system&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>hostname</span><span class=p>,</span><span class=w> </span><span class=nv>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_hostname</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-app-01&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Validating: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>hostname</span><span class=p>)</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=w>    </span><span class=c1>-- Check OS version</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>platform</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_platform</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-app-01&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span><span class=w> </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Cannot get platform: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span><span class=w> </span><span class=kr>end</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>os</span><span class=w> </span><span class=o>~=</span><span class=w> </span><span class=s2>&quot;linux&quot;</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Expected Linux, got: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>platform</span><span class=p>.</span><span class=py>os</span><span class=p>)</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>    </span><span class=c1>-- Check memory</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>mem</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_memory</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-app-01&quot;</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span><span class=w> </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Cannot get memory: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span><span class=w> </span><span class=kr>end</span>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>mem_gb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>mem</span><span class=p>.</span><span class=py>total</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>1024</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>mem_gb</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>8</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-36-19><a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Insufficient memory: %.2f GB (need 8 GB)&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>mem_gb</span><span class=p>))</span>
</span><span id=__span-36-20><a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-36-21><a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a>
</span><span id=__span-36-22><a id=__codelineno-36-22 name=__codelineno-36-22 href=#__codelineno-36-22></a><span class=w>    </span><span class=c1>-- Check disk space</span>
</span><span id=__span-36-23><a id=__codelineno-36-23 name=__codelineno-36-23 href=#__codelineno-36-23></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>disk</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_disk</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-36-24><a id=__codelineno-36-24 name=__codelineno-36-24 href=#__codelineno-36-24></a><span class=w>        </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-app-01&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-36-25><a id=__codelineno-36-25 name=__codelineno-36-25 href=#__codelineno-36-25></a><span class=w>        </span><span class=nv>mountpoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/&quot;</span><span class=w> </span>
</span><span id=__span-36-26><a id=__codelineno-36-26 name=__codelineno-36-26 href=#__codelineno-36-26></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-36-27><a id=__codelineno-36-27 name=__codelineno-36-27 href=#__codelineno-36-27></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span><span class=w> </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Cannot get disk info: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span><span class=w> </span><span class=kr>end</span>
</span><span id=__span-36-28><a id=__codelineno-36-28 name=__codelineno-36-28 href=#__codelineno-36-28></a>
</span><span id=__span-36-29><a id=__codelineno-36-29 name=__codelineno-36-29 href=#__codelineno-36-29></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>disk</span><span class=p>.</span><span class=py>used_percent</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>80</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-36-30><a id=__codelineno-36-30 name=__codelineno-36-30 href=#__codelineno-36-30></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;Disk usage too high: %.1f%%&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>disk</span><span class=p>.</span><span class=py>used_percent</span><span class=p>))</span>
</span><span id=__span-36-31><a id=__codelineno-36-31 name=__codelineno-36-31 href=#__codelineno-36-31></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-36-32><a id=__codelineno-36-32 name=__codelineno-36-32 href=#__codelineno-36-32></a>
</span><span id=__span-36-33><a id=__codelineno-36-33 name=__codelineno-36-33 href=#__codelineno-36-33></a><span class=w>    </span><span class=c1>-- Check required package</span>
</span><span id=__span-36-34><a id=__codelineno-36-34 name=__codelineno-36-34 href=#__codelineno-36-34></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>pkg</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_package</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-36-35><a id=__codelineno-36-35 name=__codelineno-36-35 href=#__codelineno-36-35></a><span class=w>        </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-app-01&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-36-36><a id=__codelineno-36-36 name=__codelineno-36-36 href=#__codelineno-36-36></a><span class=w>        </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;docker&quot;</span><span class=w> </span>
</span><span id=__span-36-37><a id=__codelineno-36-37 name=__codelineno-36-37 href=#__codelineno-36-37></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-36-38><a id=__codelineno-36-38 name=__codelineno-36-38 href=#__codelineno-36-38></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=kr>then</span><span class=w> </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Cannot check package: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>err</span><span class=p>)</span><span class=w> </span><span class=kr>end</span>
</span><span id=__span-36-39><a id=__codelineno-36-39 name=__codelineno-36-39 href=#__codelineno-36-39></a>
</span><span id=__span-36-40><a id=__codelineno-36-40 name=__codelineno-36-40 href=#__codelineno-36-40></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=ow>not</span><span class=w> </span><span class=nv>pkg</span><span class=p>.</span><span class=py>installed</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-36-41><a id=__codelineno-36-41 name=__codelineno-36-41 href=#__codelineno-36-41></a><span class=w>        </span><span class=nb>error</span><span class=p>(</span><span class=s2>&quot;Docker is not installed&quot;</span><span class=p>)</span>
</span><span id=__span-36-42><a id=__codelineno-36-42 name=__codelineno-36-42 href=#__codelineno-36-42></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-36-43><a id=__codelineno-36-43 name=__codelineno-36-43 href=#__codelineno-36-43></a>
</span><span id=__span-36-44><a id=__codelineno-36-44 name=__codelineno-36-44 href=#__codelineno-36-44></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;✓ All validations passed!&quot;</span><span class=p>)</span>
</span><span id=__span-36-45><a id=__codelineno-36-45 name=__codelineno-36-45 href=#__codelineno-36-45></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div> <h3 id=example-2-dynamic-inventory-based-on-facts>Example 2: Dynamic Inventory Based on Facts<a class=headerlink href=#example-2-dynamic-inventory-based-on-facts title="Permanent link">&para;</a></h3> <div class="language-lua highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;discover_web_servers&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>agents</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s2>&quot;server-01&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;server-02&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;server-03&quot;</span><span class=p>}</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>web_servers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=w>    </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>agents</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=w>        </span><span class=c1>-- Check if nginx is running</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>        </span><span class=kd>local</span><span class=w> </span><span class=nv>svc</span><span class=p>,</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_service</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=w>            </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>agent</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=w>            </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;nginx&quot;</span><span class=w> </span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=w>        </span><span class=p>})</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=w>        </span><span class=kr>if</span><span class=w> </span><span class=ow>not</span><span class=w> </span><span class=nv>err</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=nv>svc</span><span class=p>.</span><span class=py>status</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;active&quot;</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=w>            </span><span class=c1>-- Get IP address</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class=w>            </span><span class=kd>local</span><span class=w> </span><span class=nv>iface</span><span class=p>,</span><span class=w> </span><span class=nv>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_network</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a><span class=w>                </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>agent</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a><span class=w>                </span><span class=nv>interface</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eth0&quot;</span><span class=w> </span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a><span class=w>            </span><span class=p>})</span>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=w>            </span><span class=kr>if</span><span class=w> </span><span class=nv>iface</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=o>#</span><span class=nv>iface</span><span class=p>.</span><span class=py>addresses</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a><span class=w>                </span><span class=nb>table.insert</span><span class=p>(</span><span class=nv>web_servers</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=w>                    </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>agent</span><span class=p>,</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a><span class=w>                    </span><span class=nv>ip</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>iface</span><span class=p>.</span><span class=py>addresses</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a><span class=w>                </span><span class=p>})</span>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a><span class=w>            </span><span class=kr>end</span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class=w>        </span><span class=kr>end</span>
</span><span id=__span-37-26><a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-37-27><a id=__codelineno-37-27 name=__codelineno-37-27 href=#__codelineno-37-27></a>
</span><span id=__span-37-28><a id=__codelineno-37-28 name=__codelineno-37-28 href=#__codelineno-37-28></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Discovered Web Servers:&quot;</span><span class=p>)</span>
</span><span id=__span-37-29><a id=__codelineno-37-29 name=__codelineno-37-29 href=#__codelineno-37-29></a><span class=w>    </span><span class=kr>for</span><span class=w> </span><span class=nv>_</span><span class=p>,</span><span class=w> </span><span class=nv>server</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nb>ipairs</span><span class=p>(</span><span class=nv>web_servers</span><span class=p>)</span><span class=w> </span><span class=kr>do</span>
</span><span id=__span-37-30><a id=__codelineno-37-30 name=__codelineno-37-30 href=#__codelineno-37-30></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=nb>string.format</span><span class=p>(</span><span class=s2>&quot;  - %s: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nv>server</span><span class=p>.</span><span class=py>name</span><span class=p>,</span><span class=w> </span><span class=nv>server</span><span class=p>.</span><span class=py>ip</span><span class=p>))</span>
</span><span id=__span-37-31><a id=__codelineno-37-31 name=__codelineno-37-31 href=#__codelineno-37-31></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-37-32><a id=__codelineno-37-32 name=__codelineno-37-32 href=#__codelineno-37-32></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div> <h3 id=example-3-conditional-deployment-based-on-system-state>Example 3: Conditional Deployment Based on System State<a class=headerlink href=#example-3-conditional-deployment-based-on-system-state title="Permanent link">&para;</a></h3> <div class="language-lua highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=nf>task</span><span class=p>(</span><span class=s2>&quot;deploy_app&quot;</span><span class=p>,</span><span class=w> </span><span class=kr>function</span><span class=p>()</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;app-server-01&quot;</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>    </span><span class=c1>-- Get current system state</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>platform</span><span class=p>,</span><span class=w> </span><span class=nv>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_platform</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>mem</span><span class=p>,</span><span class=w> </span><span class=nv>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_memory</span><span class=p>({</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>agent</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>    </span><span class=c1>-- Decide deployment strategy based on available resources</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>mem</span><span class=p>.</span><span class=py>available</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=kr>then</span><span class=w>  </span><span class=c1>-- Less than 2GB</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Low memory - using minimal deployment&quot;</span><span class=p>)</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=w>        </span><span class=c1>-- Deploy with minimal resources</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=w>    </span><span class=kr>else</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Sufficient memory - using full deployment&quot;</span><span class=p>)</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=w>        </span><span class=c1>-- Deploy with full resources</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=w>    </span><span class=c1>-- Check if old version is installed</span>
</span><span id=__span-38-18><a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=w>    </span><span class=kd>local</span><span class=w> </span><span class=nv>old_app</span><span class=p>,</span><span class=w> </span><span class=nv>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>facts</span><span class=p>.</span><span class=nf>get_package</span><span class=p>({</span><span class=w> </span>
</span><span id=__span-38-19><a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=w>        </span><span class=nv>agent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>agent</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-38-20><a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a><span class=w>        </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;myapp&quot;</span><span class=w> </span>
</span><span id=__span-38-21><a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-38-22><a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a>
</span><span id=__span-38-23><a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=nv>old_app</span><span class=p>.</span><span class=py>installed</span><span class=w> </span><span class=kr>then</span>
</span><span id=__span-38-24><a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Stopping old version: &quot;</span><span class=w> </span><span class=o>..</span><span class=w> </span><span class=nv>old_app</span><span class=p>.</span><span class=py>version</span><span class=p>)</span>
</span><span id=__span-38-25><a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=w>        </span><span class=nv>systemd</span><span class=p>.</span><span class=nf>stop</span><span class=p>({</span><span class=w> </span><span class=nv>unit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;myapp&quot;</span><span class=w> </span><span class=p>}):</span><span class=nf>delegate_to</span><span class=p>(</span><span class=nv>agent</span><span class=p>)</span>
</span><span id=__span-38-26><a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=w>    </span><span class=kr>end</span>
</span><span id=__span-38-27><a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a>
</span><span id=__span-38-28><a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=w>    </span><span class=c1>-- Continue with deployment...</span>
</span><span id=__span-38-29><a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a><span class=w>    </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Deploying new version...&quot;</span><span class=p>)</span>
</span><span id=__span-38-30><a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a><span class=kr>end</span><span class=p>)</span>
</span></code></pre></div> <h2 id=best-practices>Best Practices<a class=headerlink href=#best-practices title="Permanent link">&para;</a></h2> <ol> <li><strong>Error Handling</strong>: Always check for errors when calling facts functions</li> <li><strong>Agent Availability</strong>: Ensure the agent is online before querying facts</li> <li><strong>Caching</strong>: Facts are cached by the master; they may not reflect real-time state</li> <li><strong>Performance</strong>: Avoid excessive fact queries in loops; cache results when possible</li> <li><strong>Validation</strong>: Use facts for pre-deployment validation to catch issues early</li> </ol> <h2 id=see-also>See Also<a class=headerlink href=#see-also title="Permanent link">&para;</a></h2> <ul> <li><a href=./agent.md>Agent Module</a> - Managing agents</li> <li><a href=../infra_test/ >InfraTest Module</a> - Infrastructure testing</li> <li><a href=../pkg/ >Package Module</a> - Package management</li> <li><a href=../systemd/ >Systemd Module</a> - Service management</li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 2, 2025 23:09:13 UTC">October 2, 2025</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by <a href="https://github.com/chalkan3/sloth-runner/issues/new/?title=[Feedback]+Facts%20Module+-+/modules/facts/" target=_blank rel=noopener>telling us what you need</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Sloth Runner Team. All rights reserved. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/chalkan3-sloth/sloth-runner target=_blank rel=noopener title="GitHub Repository" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://hub.docker.com/r/slothrunner/sloth-runner target=_blank rel=noopener title="Docker Hub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg> </a> <a href=https://discord.gg/sloth-runner target=_blank rel=noopener title="Discord Community" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "header.autohide", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.tooltips", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../../javascripts/extra.js></script> </body> </html>