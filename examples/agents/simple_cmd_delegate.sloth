-- Exemplo SIMPLES e FUNCIONAL usando delegate_to via cmd
-- Este exemplo usa o caminho que funciona: exec.run com comandos shell

TaskDefinitions = {
    simple_remote_commands = {
        description = "Comandos simples executados remotamente",
        tasks = {
            {
                name = "hostname_check",
                description = "Verifica hostname do agente",
                command = function()
                    log.info("üñ•Ô∏è  Verificando hostname do agente...")
                    
                    local output, err, failed = exec.run("hostname && echo '---' && whoami")
                    
                    if not failed then
                        log.info("‚úÖ Hostname obtido com sucesso!")
                        log.info("üìã Resultado:\n" .. output)
                        return true, "Hostname verificado"
                    else
                        log.error("‚ùå Falha: " .. (err or "erro desconhecido"))
                        return false, "Erro ao verificar hostname"
                    end
                end,
                delegate_to = "ladyguica",
                timeout = "30s"
            },
            {
                name = "list_home",
                description = "Lista arquivos do HOME",
                command = function()
                    log.info("üìÇ Listando arquivos do HOME...")
                    
                    local output, err, failed = exec.run("ls -la $HOME | head -20")
                    
                    if not failed then
                        log.info("‚úÖ Arquivos listados com sucesso!")
                        log.info("üìã Primeiros 20 arquivos:\n" .. output)
                        return true, "Listagem conclu√≠da"
                    else
                        log.error("‚ùå Falha: " .. (err or "erro desconhecido"))
                        return false, "Erro ao listar"
                    end
                end,
                delegate_to = "ladyguica",
                timeout = "30s"
            },
            {
                name = "system_info",
                description = "Coleta informa√ß√µes do sistema",
                command = function()
                    log.info("‚ÑπÔ∏è  Coletando informa√ß√µes do sistema...")
                    
                    local cmd = [[
echo "=== SISTEMA ==="
uname -a
echo ""
echo "=== DATA/HORA ==="
date
echo ""
echo "=== USU√ÅRIO ==="
whoami
echo ""
echo "=== DIRET√ìRIO ==="
pwd
]]
                    
                    local output, err, failed = exec.run(cmd)
                    
                    if not failed then
                        log.info("‚úÖ Informa√ß√µes coletadas!")
                        log.info("üìã Sistema:\n" .. output)
                        return true, "Info coletada"
                    else
                        log.error("‚ùå Falha: " .. (err or "erro desconhecido"))
                        return false, "Erro ao coletar"
                    end
                end,
                delegate_to = "keiteguica",
                timeout = "30s"
            }
        }
    }
}
