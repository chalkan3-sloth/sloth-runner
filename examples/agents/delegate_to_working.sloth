-- EXEMPLO FUNCIONANDO: delegate_to usando TaskDefinitions (Legacy)
-- Este formato Ã© compatÃ­vel com o envio para agentes remotos

workflow({
    name = "test_remote_execution",
    description = "Teste execuÃ§Ã£o remota funcionando",
    tasks = {
        {
            name = "test_hostname_on_ladyguica",
            description = "Executa hostname no agente ladyguica",
            run = function()
                log.info("ğŸš€ Executando comando remoto...")

                -- Executa comando no agente remoto
                local output, error, failed = exec.run("hostname && date && echo 'âœ… Comando executado no agente remoto!'")

                if not failed then
                    log.info("âœ… Sucesso no agente remoto!")
                    log.info("ğŸ“ SaÃ­da: " .. output)
                    return {changed = true, message = "Comando executado com sucesso"}
                else
                    log.error("âŒ Falha: " .. (error or "erro desconhecido"))
                    return {failed = true, message = "Comando falhou"}
                end
            end,
            delegate_to = "ladyguica",
            timeout = "30s"
        },
        {
            name = "test_ls_on_keiteguica",
            description = "Lista arquivos no agente keiteguica",
            run = function()
                log.info("ğŸ” Listando arquivos no agente remoto...")

                local output, error, failed = exec.run("ls -la $HOME && echo 'ğŸ“‚ Listagem completa!'")

                if not failed then
                    log.info("âœ… Listagem realizada com sucesso!")
                    log.info("ğŸ“‚ Arquivos:\n" .. output)
                    return {changed = true, message = "Listagem concluÃ­da"}
                else
                    log.error("âŒ Falha na listagem: " .. (error or "erro desconhecido"))
                    return {failed = true, message = "Listagem falhou"}
                end
            end,
            delegate_to = "keiteguica",
            timeout = "30s"
        }
    }
})
