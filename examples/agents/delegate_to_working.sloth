-- EXEMPLO FUNCIONANDO: delegate_to usando TaskDefinitions (Legacy)
-- Este formato √© compat√≠vel com o envio para agentes remotos

TaskDefinitions = {
    test_remote_execution = {
        description = "Teste execu√ß√£o remota funcionando",
        tasks = {
            {
                name = "test_hostname_on_ladyguica",
                description = "Executa hostname no agente ladyguica",
                command = function()
                    log.info("üöÄ Executando comando remoto...")
                    
                    -- Executa comando no agente remoto
                    local output, error, failed = exec.run("hostname && date && echo '‚úÖ Comando executado no agente remoto!'")
                    
                    if not failed then
                        log.info("‚úÖ Sucesso no agente remoto!")
                        log.info("üìù Sa√≠da: " .. output)
                        return true, "Comando executado com sucesso"
                    else
                        log.error("‚ùå Falha: " .. (error or "erro desconhecido"))
                        return false, "Comando falhou"
                    end
                end,
                delegate_to = "ladyguica",
                timeout = "30s"
            },
            {
                name = "test_ls_on_keiteguica", 
                description = "Lista arquivos no agente keiteguica",
                command = function()
                    log.info("üîç Listando arquivos no agente remoto...")
                    
                    local output, error, failed = exec.run("ls -la $HOME && echo 'üìÇ Listagem completa!'")
                    
                    if not failed then
                        log.info("‚úÖ Listagem realizada com sucesso!")
                        log.info("üìÇ Arquivos:\n" .. output)
                        return true, "Listagem conclu√≠da"
                    else
                        log.error("‚ùå Falha na listagem: " .. (error or "erro desconhecido"))
                        return false, "Listagem falhou"
                    end
                end,
                delegate_to = "keiteguica",
                timeout = "30s"
            }
        }
    }
}