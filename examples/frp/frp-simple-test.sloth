-- Simple FRP Test
-- Basic test to verify FRP module registration

local test_task = task("test_frp_module")
    :description("Test if FRP module is available")
    :command(function()
        log.info("Testing FRP module...")

        -- Test 1: Check if frp is available
        if frp == nil then
            log.error("FRP module is not registered!")
            return false, "FRP module not found"
        end
        log.info("✓ FRP module is registered")

        -- Test 2: Check if frp.server is available
        if type(frp.server) ~= "function" then
            log.error("frp.server is not a function!")
            return false, "frp.server not found"
        end
        log.info("✓ frp.server() is available")

        -- Test 3: Check if frp.client is available
        if type(frp.client) ~= "function" then
            log.error("frp.client is not a function!")
            return false, "frp.client not found"
        end
        log.info("✓ frp.client() is available")

        -- Test 4: Check if frp.install is available
        if type(frp.install) ~= "function" then
            log.error("frp.install is not a function!")
            return false, "frp.install not found"
        end
        log.info("✓ frp.install() is available")

        -- Test 5: Create a server instance
        local server = frp.server("test")
        if server == nil then
            log.error("Failed to create server instance!")
            return false, "Server instance creation failed"
        end
        log.info("✓ Server instance created successfully")

        -- Test 6: Create a client instance
        local client = frp.client("test")
        if client == nil then
            log.error("Failed to create client instance!")
            return false, "Client instance creation failed"
        end
        log.info("✓ Client instance created successfully")

        log.info("All FRP module tests passed!")
        return true, "FRP module is working correctly"
    end)
    :build()

workflow
    .define("frp_module_test")
    :description("Test FRP module registration")
    :version("1.0.0")
    :tasks({test_task})
    :config({
        timeout = "5m",
        create_workdir_before_run = false
    })
