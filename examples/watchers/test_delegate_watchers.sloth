-- Test Watcher Registration with delegate_to
-- Watchers sÃ£o automaticamente registrados no agent onde o cÃ³digo executa

workflow("test_delegate_watchers")
    :description("Test watcher registration with delegate_to")
    :tasks({
        task("register_watchers_on_lady_guica")
            :description("Register watchers on lady-guica agent")
            :delegate_to("lady-guica")
            :shell([[
                echo "ğŸ§ª Registering watchers on lady-guica via delegate_to..."
            ]])
            :on_complete(function()
                -- Este cÃ³digo roda NO AGENT lady-guica
                -- EntÃ£o os watchers sÃ£o registrados LÃ automaticamente!

                print("ğŸ“ Registering CPU watcher...")
                local cpu_id = watcher.register.cpu({
                    threshold = 50,
                    when = {'above'},
                    interval = '10s'
                })
                print("âœ“ CPU watcher: " .. cpu_id)

                print("ğŸ“ Registering memory watcher...")
                local memory_id = watcher.register.memory({
                    threshold = 70,
                    when = {'above'},
                    interval = '10s'
                })
                print("âœ“ Memory watcher: " .. memory_id)

                print("ğŸ“ Registering file watcher...")
                local file_id = watcher.register.file({
                    file_path = '/tmp/test_watcher.txt',
                    when = {'created', 'changed', 'deleted'},
                    check_hash = true,
                    interval = '5s'
                })
                print("âœ“ File watcher: " .. file_id)

                print("ğŸ‰ All watchers registered on lady-guica!")
            end)
    })
