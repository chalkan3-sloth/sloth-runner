-- Test Modern DSL Only (No TaskDefinitions)
-- This demonstrates the new Modern DSL syntax without legacy TaskDefinitions

-- Example 1: Simple workflow with inline task definition using workflow()
workflow({
    name = "simple_test",
    description = "Simple test workflow using workflow() function",
    tasks = {
        {
            name = "hello",
            description = "Say hello",
            run = function(this, params)
                log.info("Hello from Modern DSL!")
                return {changed = false, message = "Hello executed"}
            end
        },
        {
            name = "goodbye",
            description = "Say goodbye",
            run = function(this, params)
                log.info("Goodbye from Modern DSL!")
                return {changed = false, message = "Goodbye executed"}
            end
        }
    }
})

-- Example 2: Using workflow.define() with fluent builder API
local task1 = task("check_system")
    :description("Check system information")
    :command(function(this, params)
        local hostname_out = exec.run("hostname")
        log.info("Hostname: " .. hostname_out)
        return {changed = false, message = "System checked"}
    end)
    :build()

local task2 = task("check_date")
    :description("Check current date")
    :command(function(this, params)
        local date_out = exec.run("date")
        log.info("Date: " .. date_out)
        return {changed = false, message = "Date checked"}
    end)
    :build()

workflow.define("system_check")
    :description("Check system information workflow")
    :version("1.0.0")
    :tasks({task1, task2})
    :on_complete(function(success, results)
        if success then
            log.info("System check completed successfully!")
        else
            log.error("System check failed!")
        end
        return {changed = false, message = "Complete"}
    end)

-- Example 3: Using workflow() with fluent builder API
workflow("advanced_workflow")
    :description("Advanced workflow with multiple tasks")
    :version("2.0.0")
    :tasks({
        {
            name = "setup",
            description = "Setup phase",
            run = function(this, params)
                log.info("Setting up...")
                return {changed = false, message = "Setup complete"}
            end
        },
        {
            name = "execute",
            description = "Execute phase",
            run = function(this, params)
                log.info("Executing...")
                return {changed = false, message = "Execute complete"}
            end
        },
        {
            name = "cleanup",
            description = "Cleanup phase",
            run = function(this, params)
                log.info("Cleaning up...")
                return {changed = false, message = "Cleanup complete"}
            end
        }
    })
    :config({
        timeout = "10m",
        max_parallel_tasks = 1
    })
    :on_complete(function(success, results)
        log.info("Advanced workflow completed!")
        return {changed = false, message = "Complete"}
    end)

print("Modern DSL workflows defined successfully!")
print("Available workflows: simple_test, system_check, advanced_workflow")